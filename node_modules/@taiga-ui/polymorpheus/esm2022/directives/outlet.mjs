import { ChangeDetectorRef, Directive, inject, INJECTOR, Input, TemplateRef, ViewContainerRef, } from '@angular/core';
import { PolymorpheusComponent } from '../classes/component';
import { PolymorpheusContext } from '../classes/context';
import { PolymorpheusTemplate } from './template';
import * as i0 from "@angular/core";
class PolymorpheusOutlet {
    constructor() {
        this.vcr = inject(ViewContainerRef);
        this.i = inject(INJECTOR);
        this.t = inject(TemplateRef);
        this.content = '';
    }
    static ngTemplateContextGuard(_dir, _ctx) {
        return true;
    }
    ngOnChanges({ content }) {
        const context = this.getContext();
        this.c?.injector.get(ChangeDetectorRef).markForCheck();
        if (!content) {
            return;
        }
        this.vcr.clear();
        const proxy = context &&
            new Proxy(context, {
                get: (_, key) => this.getContext()?.[key],
            });
        if (isComponent(this.content)) {
            this.process(this.content, proxy);
        }
        else if ((context instanceof PolymorpheusContext && context.$implicit) != null) {
            this.vcr.createEmbeddedView(this.template, proxy, { injector: this.i });
        }
    }
    ngDoCheck() {
        if (isDirective(this.content)) {
            this.content.check();
        }
    }
    get template() {
        if (isDirective(this.content)) {
            return this.content.template;
        }
        return this.content instanceof TemplateRef ? this.content : this.t;
    }
    getContext() {
        if (isTemplate(this.content) || isComponent(this.content)) {
            return this.context;
        }
        return new PolymorpheusContext(typeof this.content === 'function'
            ? this.content(this.context ?? {})
            : this.content);
    }
    process(content, proxy) {
        const injector = content.createInjector(this.i, proxy);
        this.c = this.vcr.createComponent(content.component, { injector });
    }
    /** @nocollapse */ static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: PolymorpheusOutlet, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    /** @nocollapse */ static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.2.12", type: PolymorpheusOutlet, isStandalone: true, selector: "[polymorpheusOutlet]", inputs: { content: ["polymorpheusOutlet", "content"], context: ["polymorpheusOutletContext", "context"] }, usesOnChanges: true, ngImport: i0 }); }
}
export { PolymorpheusOutlet };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: PolymorpheusOutlet, decorators: [{
            type: Directive,
            args: [{
                    standalone: true,
                    selector: '[polymorpheusOutlet]',
                }]
        }], propDecorators: { content: [{
                type: Input,
                args: ['polymorpheusOutlet']
            }], context: [{
                type: Input,
                args: ['polymorpheusOutletContext']
            }] } });
function isDirective(content) {
    return content instanceof PolymorpheusTemplate;
}
function isComponent(content) {
    return content instanceof PolymorpheusComponent;
}
function isTemplate(content) {
    return isDirective(content) || content instanceof TemplateRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3V0bGV0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmctcG9seW1vcnBoZXVzL3NyYy9kaXJlY3RpdmVzL291dGxldC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQ0gsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxNQUFNLEVBQ04sUUFBUSxFQUNSLEtBQUssRUFDTCxXQUFXLEVBQ1gsZ0JBQWdCLEdBQ25CLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBQyxxQkFBcUIsRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBQzNELE9BQU8sRUFBQyxtQkFBbUIsRUFBQyxNQUFNLG9CQUFvQixDQUFDO0FBR3ZELE9BQU8sRUFBQyxvQkFBb0IsRUFBQyxNQUFNLFlBQVksQ0FBQzs7QUFFaEQsTUFJYSxrQkFBa0I7SUFKL0I7UUFLcUIsUUFBRyxHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQy9CLE1BQUMsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDckIsTUFBQyxHQUNkLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUtqQixZQUFPLEdBQTJCLEVBQUUsQ0FBQztLQXNFL0M7SUFqRVUsTUFBTSxDQUFDLHNCQUFzQixDQUNoQyxJQUEyQixFQUMzQixJQUFTO1FBRVQsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVNLFdBQVcsQ0FBQyxFQUFDLE9BQU8sRUFBZ0I7UUFDdkMsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBRWxDLElBQUksQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBRXZELElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDVixPQUFPO1NBQ1Y7UUFFRCxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBRWpCLE1BQU0sS0FBSyxH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b0NoZWNrLCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXN9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBEaXJlY3RpdmUsXG4gICAgaW5qZWN0LFxuICAgIElOSkVDVE9SLFxuICAgIElucHV0LFxuICAgIFRlbXBsYXRlUmVmLFxuICAgIFZpZXdDb250YWluZXJSZWYsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQge1BvbHltb3JwaGV1c0NvbXBvbmVudH0gZnJvbSAnLi4vY2xhc3Nlcy9jb21wb25lbnQnO1xuaW1wb3J0IHtQb2x5bW9ycGhldXNDb250ZXh0fSBmcm9tICcuLi9jbGFzc2VzL2NvbnRleHQnO1xuaW1wb3J0IHR5cGUge1BvbHltb3JwaGV1c0NvbnRlbnR9IGZyb20gJy4uL3R5cGVzL2NvbnRlbnQnO1xuaW1wb3J0IHR5cGUge1BvbHltb3JwaGV1c1ByaW1pdGl2ZX0gZnJvbSAnLi4vdHlwZXMvcHJpbWl0aXZlJztcbmltcG9ydCB7UG9seW1vcnBoZXVzVGVtcGxhdGV9IGZyb20gJy4vdGVtcGxhdGUnO1xuXG5ARGlyZWN0aXZlKHtcbiAgICBzdGFuZGFsb25lOiB0cnVlLFxuICAgIHNlbGVjdG9yOiAnW3BvbHltb3JwaGV1c091dGxldF0nLFxufSlcbmV4cG9ydCBjbGFzcyBQb2x5bW9ycGhldXNPdXRsZXQ8Qz4gaW1wbGVtZW50cyBPbkNoYW5nZXMsIERvQ2hlY2sge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgdmNyID0gaW5qZWN0KFZpZXdDb250YWluZXJSZWYpO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgaSA9IGluamVjdChJTkpFQ1RPUik7XG4gICAgcHJpdmF0ZSByZWFkb25seSB0OiBUZW1wbGF0ZVJlZjxQb2x5bW9ycGhldXNDb250ZXh0PFBvbHltb3JwaGV1c1ByaW1pdGl2ZT4+ID1cbiAgICAgICAgaW5qZWN0KFRlbXBsYXRlUmVmKTtcblxuICAgIHByaXZhdGUgYz86IENvbXBvbmVudFJlZjx1bmtub3duPjtcblxuICAgIEBJbnB1dCgncG9seW1vcnBoZXVzT3V0bGV0JylcbiAgICBwdWJsaWMgY29udGVudDogUG9seW1vcnBoZXVzQ29udGVudDxDPiA9ICcnO1xuXG4gICAgQElucHV0KCdwb2x5bW9ycGhldXNPdXRsZXRDb250ZXh0JylcbiAgICBwdWJsaWMgY29udGV4dD86IEM7XG5cbiAgICBwdWJsaWMgc3RhdGljIG5nVGVtcGxhdGVDb250ZXh0R3VhcmQ8VD4oXG4gICAgICAgIF9kaXI6IFBvbHltb3JwaGV1c091dGxldDxUPixcbiAgICAgICAgX2N0eDogYW55LFxuICAgICk6IF9jdHggaXMgUG9seW1vcnBoZXVzQ29udGV4dDxUIGV4dGVuZHMgUG9seW1vcnBoZXVzUHJpbWl0aXZlID8gVCA6IG5ldmVyPiB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHB1YmxpYyBuZ09uQ2hhbmdlcyh7Y29udGVudH06IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IHRoaXMuZ2V0Q29udGV4dCgpO1xuXG4gICAgICAgIHRoaXMuYz8uaW5qZWN0b3IuZ2V0KENoYW5nZURldGVjdG9yUmVmKS5tYXJrRm9yQ2hlY2soKTtcblxuICAgICAgICBpZiAoIWNvbnRlbnQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudmNyLmNsZWFyKCk7XG5cbiAgICAgICAgY29uc3QgcHJveHkgPVxuICAgICAgICAgICAgY29udGV4dCAmJlxuICAgICAgICAgICAgKG5ldyBQcm94eShjb250ZXh0IGFzIG9iamVjdCwge1xuICAgICAgICAgICAgICAgIGdldDogKF8sIGtleSkgPT5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRDb250ZXh0KCk/LltrZXkgYXMga2V5b2YgKEMgfCBQb2x5bW9ycGhldXNDb250ZXh0PGFueT4pXSxcbiAgICAgICAgICAgIH0pIGFzIHVua25vd24gYXMgQyk7XG5cbiAgICAgICAgaWYgKGlzQ29tcG9uZW50KHRoaXMuY29udGVudCkpIHtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzcyh0aGlzLmNvbnRlbnQsIHByb3h5KTtcbiAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICAgIChjb250ZXh0IGluc3RhbmNlb2YgUG9seW1vcnBoZXVzQ29udGV4dCAmJiBjb250ZXh0LiRpbXBsaWNpdCkgIT0gbnVsbFxuICAgICAgICApIHtcbiAgICAgICAgICAgIHRoaXMudmNyLmNyZWF0ZUVtYmVkZGVkVmlldyh0aGlzLnRlbXBsYXRlLCBwcm94eSwge2luamVjdG9yOiB0aGlzLml9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBuZ0RvQ2hlY2soKTogdm9pZCB7XG4gICAgICAgIGlmIChpc0RpcmVjdGl2ZSh0aGlzLmNvbnRlbnQpKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQuY2hlY2soKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0IHRlbXBsYXRlKCk6IFRlbXBsYXRlUmVmPHVua25vd24+IHtcbiAgICAgICAgaWYgKGlzRGlyZWN0aXZlKHRoaXMuY29udGVudCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnRlbnQudGVtcGxhdGU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5jb250ZW50IGluc3RhbmNlb2YgVGVtcGxhdGVSZWYgPyB0aGlzLmNvbnRlbnQgOiB0aGlzLnQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRDb250ZXh0KCk6IEMgfCBQb2x5bW9ycGhldXNDb250ZXh0PGFueT4gfCB1bmRlZmluZWQge1xuICAgICAgICBpZiAoaXNUZW1wbGF0ZSh0aGlzLmNvbnRlbnQpIHx8IGlzQ29tcG9uZW50KHRoaXMuY29udGVudCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnRleHQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3IFBvbHltb3JwaGV1c0NvbnRleHQoXG4gICAgICAgICAgICB0eXBlb2YgdGhpcy5jb250ZW50ID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgICAgICAgPyB0aGlzLmNvbnRlbnQodGhpcy5jb250ZXh0ID8/ICh7fSBhcyBhbnkpKVxuICAgICAgICAgICAgICAgIDogdGhpcy5jb250ZW50LFxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgcHJvY2Vzcyhjb250ZW50OiBQb2x5bW9ycGhldXNDb21wb25lbnQ8dW5rbm93bj4sIHByb3h5PzogQyk6IHZvaWQge1xuICAgICAgICBjb25zdCBpbmplY3RvciA9IGNvbnRlbnQuY3JlYXRlSW5qZWN0b3IodGhpcy5pLCBwcm94eSk7XG5cbiAgICAgICAgdGhpcy5jID0gdGhpcy52Y3IuY3JlYXRlQ29tcG9uZW50KGNvbnRlbnQuY29tcG9uZW50LCB7aW5qZWN0b3J9KTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGlzRGlyZWN0aXZlPEM+KFxuICAgIGNvbnRlbnQ6IFBvbHltb3JwaGV1c0NvbnRlbnQ8Qz4sXG4pOiBjb250ZW50IGlzIFBvbHltb3JwaGV1c1RlbXBsYXRlPEM+IHtcbiAgICByZXR1cm4gY29udGVudCBpbnN0YW5jZW9mIFBvbHltb3JwaGV1c1RlbXBsYXRlO1xufVxuXG5mdW5jdGlvbiBpc0NvbXBvbmVudDxDPihcbiAgICBjb250ZW50OiBQb2x5bW9ycGhldXNDb250ZW50PEM+LFxuKTogY29udGVudCBpcyBQb2x5bW9ycGhldXNDb21wb25lbnQ8YW55PiB7XG4gICAgcmV0dXJuIGNvbnRlbnQgaW5zdGFuY2VvZiBQb2x5bW9ycGhldXNDb21wb25lbnQ7XG59XG5cbmZ1bmN0aW9uIGlzVGVtcGxhdGU8Qz4oXG4gICAgY29udGVudDogUG9seW1vcnBoZXVzQ29udGVudDxDPixcbik6IGNvbnRlbnQgaXMgUG9seW1vcnBoZXVzVGVtcGxhdGU8Qz4gfCBUZW1wbGF0ZVJlZjxDPiB7XG4gICAgcmV0dXJuIGlzRGlyZWN0aXZlKGNvbnRlbnQpIHx8IGNvbnRlbnQgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZjtcbn1cbiJdfQ==